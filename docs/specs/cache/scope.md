# Scope: Cache

## In Scope

- プロバイダーの `Result` 単位でのディスクキャッシュ (scheme + identifier をキーとする)
- キャッシュ保存先は `os.UserCacheDir()/repiq/` (XDG Base Directory 準拠)
- TTL 24 時間 (全プロバイダー共通の固定値)
- `--no-cache` フラグによるキャッシュバイパス (そのリクエストのみ API から取得し、結果でキャッシュを更新)
- キャッシュヒット時は透過的に動作 (出力フォーマットに変更なし)
- 既存の全プロバイダー (GitHub, npm) への自動適用
- TTL 切れエントリの遅延削除 (読み取り時に TTL チェック → 期限切れなら無視して再フェッチ)

## Out of Scope

- `--clear-cache` コマンド (手動でディレクトリ削除すれば十分)
- インメモリキャッシュ (CLI ツールはプロセスが毎回終了するため不要)
- プロバイダーごとの個別 TTL 設定
- キャッシュサイズ上限・LRU eviction
- `cached_at` フィールドの JSON 出力への追加
- ネットワークエラー時のステイルキャッシュフォールバック (将来検討)
- キャッシュの暗号化・署名

## Success Criteria (KPI)

### Expected to Improve

- キャッシュヒット時のレスポンスタイム: <100ms (現状 1-3 秒)
- 典型的な比較ワークフロー (同一ターゲットへの重複クエリ) での API コール数: 60-70% 削減
- GitHub API レート制限の残量消費速度

### At Risk (may decrease)

- 初回クエリのレスポンスタイム: キャッシュ書き込みのオーバーヘッドにより微増 (数 ms 程度、無視できるレベル)
- ディスク使用量: キャッシュファイルが蓄積される (1 エントリあたり数 KB、実質問題にならない)

## Acceptance Gates

- [ ] キャッシュヒット時にAPIコールが発生しないことをテストで検証
- [ ] `--no-cache` フラグで常にフレッシュなデータを取得できることをテストで検証
- [ ] TTL 切れエントリが再フェッチされることをテストで検証
- [ ] キャッシュなしの場合と出力が完全に一致すること (透過性)
- [ ] 既存テストが全て pass すること (リグレッションなし)
- [ ] `os.UserCacheDir()` が使用されていること (XDG 準拠)

## Experiment Info (if applicable)

該当なし (全ユーザーに一律適用)
